webpackJsonp([13],{"3mRV":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s("4YfN"),i=s.n(n),a=s("9rMa"),c={name:"client",data:function(){return{userList:[],checkedAll:!1,isIndeterminate:!1,checkedArr:[],isActiveGroupInfoList:-1,isActiveGroupInfoListName:"全部客户",checkedTabs:[],allGroupID:[],userRemarkName:"",menuName:"",userTab:"",groupInfoList:[],isAddMenuShow:!1,isChangeRemarkShow:!1,isChangeMenuShow:!1,isDelMenuShow:!1,isChangeTabsShow:!1}},methods:{getAlltabs:function(){var e=this;this.ajax.get(this.BASE_URL+"/more/customerscategories",{params:{shop_id:this.shopID}}).then(function(t){e.groupInfoList=t.data.data}).catch(function(e){})},checkAll:function(){var e=this.userList,t=this.checkedArr;if(!0===this.isIndeterminate)for(var s=0;s<e.length;s++)t.indexOf(e[s].userID)<0&&(this.changeChecked(s),e[s].isChecked=!e[s].isChecked);else for(var n=0;n<e.length;n++)this.changeChecked(n),e[n].isChecked=!e[n].isChecked},checkedTabsChange:function(){},changeChecked:function(e){var t=this.checkedArr,s=this.userList[e];t.indexOf(s.userID)<0?t.push(s.userID):t.splice(t.indexOf(s.userID),1),t.length===this.userList.length?(this.checkedAll=!0,this.isIndeterminate=!1):0===t.length?(this.checkedAll=!1,this.isIndeterminate=!1):this.isIndeterminate=!0,this.checkedArr=t},changeRemark:function(e){var t=this;this.userRemarkName=this.userList[e].remark,this.userList[e].isChangeRemarkShow=!0,setTimeout(function(){t.$refs.changeRemark[e].focus(),t.$refs.changeRemark[e].select()},250)},confirmAddMenu:function(){var e=this,t=this.menuName.replace(/[\u0391-\uFFE5]/g,"aa").length;t<=12&&t>0?this.ajax.post(this.BASE_URL+"/client/category_add",this.qs.stringify({shop_id:this.shopID,name:this.menuName})).then(function(t){e.$message({type:"success",message:"添加成功"}),e.getAlltabs()}).catch(function(e){}):t>12&&this.$message({showClose:!0,message:"标签名不得超过6个汉字或12个字符",type:"warning"}),this.isAddMenuShow=!1},confirmChangeRemark:function(e){var t=this;if(this.userRemarkName.length<=30&&this.userRemarkName.length>0){var s=this.userList[e].user_id,n=this.userTab,i=this.userRemarkName;""===n&&(n=0),this.ajax.post(this.BASE_URL+"/client/remark_edit",this.qs.stringify({shop_id:this.shopID,remark_user_id:s,remark:i,category_id:n})).then(function(s){t.userList[e].remark=t.userRemarkName,t.$message({type:"success",message:"修改成功"})}).catch(function(e){})}else this.userRemarkName.length>30&&this.$message({showClose:!0,message:"备注名不能超过30个字",type:"warning"});this.userList[e].isChangeRemarkShow=!1},confirmChangeMenu:function(){var e=this,t=this.menuName.replace(/[\u0391-\uFFE5]/g,"aa").length;if(t<=12&&t>0){var s=this.isActiveGroupInfoList,n=this.groupInfoList[s].category_id;this.ajax.post(this.BASE_URL+"/client/category_edit",this.qs.stringify({shop_id:this.shopID,category_id:n,name:this.menuName})).then(function(t){e.isChangeMenuShow=!1,e.groupInfoList[s].name=e.menuName,e.isActiveGroupInfoListName=e.menuName,e.$message({type:"success",message:"修改成功"})}).catch(function(e){})}else t>12&&this.$message({showClose:!0,message:"标签名不得超过6个汉字或12个字符",type:"warning"});this.isChangeMenuShow=!1},confirmDelMenu:function(){var e=this,t=this.isActiveGroupInfoList,s=this.groupInfoList[t].category_id;this.ajax.post(this.BASE_URL+"/client/category_delete",this.qs.stringify({user_id:this.userID,category_id:s})).then(function(t){e.isDelMenuShow=!1,e.$message({type:"success",message:"已删除"}),e.getAlltabs(),e.changeGroupInfoList(-1,"全部客户")}).catch(function(e){})},confirmChangeTabs:function(){for(var e=this.userList,t=0;t<e.length;t++)e[t].isChecked&&(e[t].userGroupId=this.checkedTabs);this.userList=e},changeGroupInfoList:function(e,t,s){e<0?this.isActiveGroupInfoListName="全部客户":(this.isActiveGroupInfoListName=t,this.ajax.get(this.BASE_URL+"/more/customerscategories",{params:{shop_id:this.shopID,category_id:s}}).then(function(e){}).catch(function(e){})),this.isActiveGroupInfoList=e},addMenu:function(){var e=this;this.isAddMenuShow=!0,this.menuName="",setTimeout(function(){e.$refs.addMenu.focus()},250)},changeMenuName:function(){var e=this;this.menuName=this.isActiveGroupInfoListName,this.isChangeMenuShow=!0,setTimeout(function(){e.$refs.changeMenuName.focus(),e.$refs.changeMenuName.select()},250)}},computed:i()({},Object(a.d)(["shopID","userID"])),created:function(){var e=this;this.ajax.get(this.BASE_URL+"/client/index",{params:{shop_id:this.shopID}}).then(function(t){if("查询成功"===t.data.message){e.isActiveGroupInfoListName="全部客户";for(var s=t.data.data[0].users,n=0;n<s.length;n++)s[n].isChangeRemarkShow=!1;e.userList=s}}).catch(function(e){}),this.getAlltabs();for(var t=this.groupInfoList.length,s=1;s<t;s++)this.allGroupID.push({id:this.groupInfoList[s].groupID,name:this.groupInfoList[s].name})}},r={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("h2",[e._v("客户管理")]),e._v(" "),s("div",{staticClass:"group-warp"},[s("div",{staticClass:"header layer"},[s("div",{staticClass:"input"},[s("el-input",{staticClass:"input-with-select",attrs:{placeholder:"用户昵称"}},[s("el-button",{attrs:{slot:"append",icon:"el-icon-search"},slot:"append"})],1)],1),e._v(" "),s("el-popover",{attrs:{placement:"bottom",width:"220",trigger:"click"},model:{value:e.isAddMenuShow,callback:function(t){e.isAddMenuShow=t},expression:"isAddMenuShow"}},[s("div",{staticClass:"popover-change-remark-name clear-float"},[s("div",[e._v("\n            标签名称：\n          ")]),e._v(" "),s("el-input",{ref:"addMenu",nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.confirmAddMenu(t):null}},model:{value:e.menuName,callback:function(t){e.menuName="string"==typeof t?t.trim():t},expression:"menuName"}}),e._v(" "),s("el-button",{staticClass:"fl-right",attrs:{type:"primary"},on:{click:e.confirmAddMenu}},[e._v("确定")]),e._v(" "),s("el-button",{staticClass:"fl-right",on:{click:function(t){e.isAddMenuShow=!1}}},[e._v("取消")])],1),e._v(" "),s("el-button",{attrs:{slot:"reference",type:"primary"},on:{click:e.addMenu},slot:"reference"},[s("span",{staticClass:"el-icon-plus"}),e._v(" 新建标签")])],1)],1),e._v(" "),s("div",{staticClass:"content"},[s("div",{staticClass:"inner-box"},[s("div",{staticClass:"global-mod"},[s("span",[e._v(e._s(e.isActiveGroupInfoListName))]),e._v(" "),e.isActiveGroupInfoList>=0?s("span",[s("el-popover",{attrs:{placement:"bottom",width:"220",trigger:"click"},model:{value:e.isChangeMenuShow,callback:function(t){e.isChangeMenuShow=t},expression:"isChangeMenuShow"}},[s("div",{staticClass:"popover-change-remark-name clear-float"},[s("div",[e._v("\n                  标签名称：\n                ")]),e._v(" "),s("el-input",{ref:"changeMenuName",nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.confirmChangeMenu(t):null}},model:{value:e.menuName,callback:function(t){e.menuName="string"==typeof t?t.trim():t},expression:"menuName"}}),e._v(" "),s("el-button",{staticClass:"fl-right",attrs:{type:"primary"},on:{click:e.confirmChangeMenu}},[e._v("确定")]),e._v(" "),s("el-button",{staticClass:"fl-right",on:{click:function(t){e.isChangeMenuShow=!1}}},[e._v("取消")])],1),e._v(" "),s("el-button",{attrs:{slot:"reference",type:"text"},on:{click:e.changeMenuName},slot:"reference"},[e._v("重命名")])],1),e._v(" "),s("el-popover",{attrs:{placement:"bottom",width:"220",trigger:"click"},model:{value:e.isDelMenuShow,callback:function(t){e.isDelMenuShow=t},expression:"isDelMenuShow"}},[s("div",{staticClass:"popover-change-remark-name clear-float"},[s("div",[e._v("\n                  删除标签后，该标签下的所有用户将失去该标签属性。是否确定删除？\n                ")]),e._v(" "),s("el-button",{staticClass:"fl-right",attrs:{type:"primary"},on:{click:e.confirmDelMenu}},[e._v("确定")]),e._v(" "),s("el-button",{staticClass:"fl-right",on:{click:function(t){e.isDelMenuShow=!1}}},[e._v("取消")])],1),e._v(" "),s("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("删除")])],1)],1):e._e()]),e._v(" "),s("div",[s("table",{staticClass:"table",staticStyle:{display:"table"},attrs:{cellspacing:"0"}},[s("thead",{staticClass:"thead",staticStyle:{display:"none"}},[s("tr",[s("th",{attrs:{colspan:"2"}},[e.userList.length?s("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.checkAll},model:{value:e.checkedAll,callback:function(t){e.checkedAll=t},expression:"checkedAll"}},[e._v("全选")]):s("el-checkbox",{attrs:{indeterminate:e.isIndeterminate,disabled:""},on:{change:e.checkAll},model:{value:e.checkedAll,callback:function(t){e.checkedAll=t},expression:"checkedAll"}},[e._v("全选")]),e._v("\n                   \n\n                  "),s("el-popover",{attrs:{placement:"bottom",width:"420",trigger:"click"},model:{value:e.isChangeTabsShow,callback:function(t){e.isChangeTabsShow=t},expression:"isChangeTabsShow"}},[s("div",{staticClass:"popover-add-tab clear-float"},[s("el-checkbox-group",{on:{change:e.checkedTabsChange},model:{value:e.checkedTabs,callback:function(t){e.checkedTabs=t},expression:"checkedTabs"}},e._l(e.groupInfoList,function(t,n){return n>0?s("el-checkbox",{key:n,attrs:{label:t.groupID}},[e._v(e._s(t.name))]):e._e()})),e._v(" "),s("el-button",{staticClass:"fl-right",attrs:{type:"primary"},on:{click:e.confirmChangeTabs}},[e._v("确定")]),e._v(" "),s("el-button",{staticClass:"fl-right",on:{click:function(t){e.isChangeTabsShow=!1}}},[e._v("取消")])],1),e._v(" "),s("el-button",{attrs:{slot:"reference",disabled:0===e.checkedArr.length},on:{click:function(t){e.isChangeTabsShow=!0}},slot:"reference"},[e._v("打标签")])],1)],1)])]),e._v(" "),s("tbody",{staticClass:"tbody clr-semi"},[e._l(e.userList,function(t,n){return e.userList.length?s("tr",{key:n},[s("td",{staticClass:"user"},[s("div",{staticClass:"user-info"},[s("a",[e._v(e._s(t.nickname))]),e._v(" "),s("span",{staticClass:"nick-name"},[e._v("\n                      ("+e._s(""===t.remark?"暂无备注":t.remark)+")\n                    ")]),e._v(" "),s("div",{staticClass:"user-tabs-area"}),e._v(" "),s("div",{staticClass:"avatar"},[s("img",{attrs:{src:t.avatar,alt:""}})]),e._v(" "),s("el-checkbox",{staticClass:"checkbox",staticStyle:{display:"none"},on:{change:function(t){e.changeChecked(n)}},model:{value:t.isChecked,callback:function(s){e.$set(t,"isChecked",s)},expression:"userInfo.isChecked"}})],1)]),e._v(" "),s("td",{staticClass:"user-opr"},[s("el-popover",{attrs:{placement:"bottom",width:"290",trigger:"click"},model:{value:t.isChangeRemarkShow,callback:function(s){e.$set(t,"isChangeRemarkShow",s)},expression:"userInfo.isChangeRemarkShow"}},[s("div",{staticClass:"popover-change-remark-name clear-float"},[s("div",[e._v("\n                        备注名称：\n\n                      ")]),e._v(" "),s("el-input",{ref:"changeRemark",refInFor:!0,nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.confirmChangeRemark(n)}},model:{value:e.userRemarkName,callback:function(t){e.userRemarkName="string"==typeof t?t.trim():t},expression:"userRemarkName"}},[s("template",{staticStyle:{color:"red"},slot:"append"},[e._v(e._s(e.userRemarkName.length)+"/30")])],2),e._v(" "),s("el-select",{staticClass:"select",attrs:{placeholder:"请选择"},model:{value:e.userTab,callback:function(t){e.userTab=t},expression:"userTab"}},e._l(e.groupInfoList,function(e,t){return s("el-option",{key:t,attrs:{label:e.name,value:e.category_id}})})),e._v(" "),s("el-button",{staticClass:"fl-right",attrs:{type:"primary"},on:{click:function(t){e.confirmChangeRemark(n)}}},[e._v("确定")]),e._v(" "),s("el-button",{staticClass:"fl-right",on:{click:function(e){t.isChangeRemarkShow=!1}}},[e._v("取消")])],1),e._v(" "),s("el-button",{attrs:{slot:"reference"},on:{click:function(t){e.changeRemark(n)}},slot:"reference"},[e._v("修改备注")])],1)],1)]):e._e()}),e._v(" "),0===e.userList.length?s("tr",{staticClass:"nodata"},[e._v("暂无数据")]):e._e()],2)])])]),e._v(" "),s("div",{staticClass:"menu-box"},[s("div",{staticClass:"menu-list text-minor"},[s("dl",[s("dt",{on:{click:function(t){e.changeGroupInfoList(-1,"全部客户")}}},[s("a",{class:[-1===e.isActiveGroupInfoList?"active":""],attrs:{href:"javascript:void(0);"}},[e._v("全部客户\n                ")])]),e._v(" "),e._l(e.groupInfoList,function(t,n){return s("dd",{key:n,on:{click:function(s){e.changeGroupInfoList(n,t.name,t.category_id)}}},[s("a",{class:[e.isActiveGroupInfoList===n?"active":""],attrs:{href:"javascript:void(0);"}},[e._v(e._s(t.name)+"\n                ")])])})],2)])])])])])},staticRenderFns:[]};var o=s("C7Lr")(c,r,!1,function(e){s("eJEq")},"data-v-f22f30ea",null);t.default=o.exports},eJEq:function(e,t){}});